<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Bot Dashboard</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Crypto Trading Bot Dashboard</h1>
            <p class="text-gray-600">Real-time trading data and positions</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Price Chart -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Price Chart</h2>
                <div id="priceChart" class="w-full h-96"></div>
            </div>

            <!-- Trading Controls -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Trading Controls</h2>
                <div class="mb-4">
                    <p class="text-gray-700">Current Balance: <span id="balance" class="font-semibold">$0.00</span></p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="executeTrade('buy')" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">Buy</button>
                    <button onclick="executeTrade('sell')" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">Sell</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Open Positions -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Open Positions</h2>
                <div id="openPositions" class="space-y-4"></div>
            </div>

            <!-- Closed Positions -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Closed Positions</h2>
                <div id="closedPositions" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialize WebSocket connection
        const socket = io();
        let chart = null;

        // Handle market updates
        socket.on('market_update', (data) => {
            updateChart(data);
            updatePositions(data);
            updateBalance(data);
        });

        // Initialize chart
        function initChart() {
            const layout = {
                title: 'BTC/USDT Price',
                xaxis: { title: 'Time' },
                yaxis: { title: 'Price' },
                plot_bgcolor: '#ffffff',
                paper_bgcolor: '#ffffff'
            };

            chart = Plotly.newPlot('priceChart', [{
                x: [],
                y: [],
                type: 'scatter',
                name: 'Price'
            }], layout);
        }

        // Update chart with new data
        function updateChart(data) {
            const update = {
                x: [data.timestamp],
                y: [data.close]
            };

            Plotly.update('priceChart', update);
        }

        // Update positions display
        function updatePositions(data) {
            // Update open positions
            const openPositionsHtml = data.positions.map(position => `
                <div class="border p-4 rounded">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold">${position.symbol}</p>
                            <p class="text-sm text-gray-600">Entry: $${position.entry_price.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">${position.side.toUpperCase()}</p>
                            <p class="text-sm text-gray-600">Qty: ${position.quantity.toFixed(4)}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('openPositions').innerHTML = openPositionsHtml || '<p class="text-gray-500">No open positions</p>';

            // Update closed positions
            const closedPositionsHtml = data.closed_positions.map(position => `
                <div class="border p-4 rounded">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold">${position.symbol}</p>
                            <p class="text-sm text-gray-600">Entry: $${position.entry_price.toFixed(2)}</p>
                            <p class="text-sm text-gray-600">Exit: $${position.exit_price.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold ${position.pnl >= 0 ? 'text-green-500' : 'text-red-500'}">
                                ${position.pnl >= 0 ? '+' : ''}$${position.pnl.toFixed(2)}
                            </p>
                            <p class="text-sm text-gray-600">${position.side.toUpperCase()}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('closedPositions').innerHTML = closedPositionsHtml || '<p class="text-gray-500">No closed positions</p>';
        }

        // Update balance display
        function updateBalance(data) {
            document.getElementById('balance').textContent = `$${data.balance.toFixed(2)}`;
        }

        // Execute trade
        async function executeTrade(action) {
            try {
                const response = await fetch('/api/trade', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action })
                });
                
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to execute trade');
                }
                
                // Success notification could be added here
            } catch (error) {
                console.error('Trade execution error:', error);
                // Error notification could be added here
            }
        }

        // Initialize chart on page load
        document.addEventListener('DOMContentLoaded', initChart);
    </script>
</body>
</html> 